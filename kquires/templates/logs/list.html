{% extends "pages/layout/sidebar.html" %}
{% load static %}
{% load i18n %}
{% block title %}
      kquires | {% trans 'Logs'%}
    {% endblock title %}
{% block content %}
<style>
.form-section {
    background-color: #fff;
    padding: 20px;

    border-radius: 10px;
  }
  .profile-card {
    text-align: center;
    background-color: #fff;
    padding: 20px;

    border-radius: 10px;
  }
  .profile-card img {
    border-radius: 50%;
    max-width: 150px;
    margin-bottom: 10px;
  }
  .custom-table {

    border-radius: 8px;
    overflow: hidden;
}
.custom-table thead {
    background-color: #f1f5f9;
}
.custom-table tbody tr {
    background-color: #ffffff;
}
.custom-table tbody tr:nth-child(even) {
    background-color: #f8f9fa;
}
.new-ticket-btn {
    margin-top: 10px;
}
.header-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: #f8f9fa; /* Background color */
    padding: 10px;
    /* Border for layout visibility */
}

.btn-new {
    background-color: #007bff; /* Blue background */
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
}

.btn-new:hover {
    background-color: #0056b3; /* Darker blue on hover */
}

.search-bar input {
    width: 300px;
    padding: 8px;

    border-radius: 4px;
}

.btn-categories {
    background-color: #f1f1f1;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    font-size: 14px;
}

</style>
<div class="d-flex align-items-center justify-content-between bg-light p-2">
    <div class="text-center" style="font-size: 20px; color:black; font-weight: bold; cursor: pointer;">
        {% trans "Activity Logs" %}
    </div>


    <div class="search-bar mx-auto" style="width: 300px; position: relative;">
        <input
          type="text"
          class="form-control form-control-sm ps-6 pe-5"
          placeholder="{% trans 'Search' %}"
        />
        <img
          src="{% static 'images/searchb.svg' %}"
          alt="{% trans 'Search Icon' %}"
          class="position-absolute top-50 translate-middle-y end-0"
          style="width: 20px; height: 20px;"
        />
      </div>
    <!-- <button class="btn btn-primary btn-sm d-flex align-items-center fs-6">
        {% trans "Filter" %}
    </button> -->

    <a href="{% url 'logs:export_activity_log_excel' %}"><img src="{% static 'images/export.svg' %}" alt="{% trans 'Section Icon' %}" class="ms-2" ></a>
</div>

<!-- Container to align table with the above div -->
<div class="container-fluid mt-3">
    <div class="form-section">
      <form>
          <div class="row">
              <div class="custom-table">
                  <table class="table text-center">
                      <thead>
                          <tr>
                              <th scope="col">{% trans "Date/Time" %}</th>
                              <th scope="col">{% trans "Username" %}</th>
                              <th scope="col">{% trans "Action" %}</th>
                              <th scope="col">{% trans "Action Description" %}</th>
                              {% comment %} <th scope="col">{% trans "Permission" %}</th> {% endcomment %}
                          </tr>
                      </thead>
                      <tbody>
                        {% for log in logs %}
                          <tr>
                              <td>{{log.timestamp}}</td>
                              <td>{{log.user.name|default:"Unknown User"}}</td>
                              <td>{{log.action}}</td>
                              <td>{{log.details}}</td>
                          </tr>
                        {% endfor %}
                      </tbody>
                  </table>
              </div>
          </div>    
      </form>

      <div class="d-flex justify-content-start align-items-center mb-3">
        <label for="limit-select" class="form-label me-2">{% trans "Items per page" %}:</label>
        <select id="limit-select" class="form-select w-auto" onchange="changeLimit()">
            <option value="10" {% if request.GET.page_size == "10" %}selected{% endif %}>10</option>
            <option value="20" {% if request.GET.page_size == "20" %}selected{% endif %}>20</option>
            <option value="50" {% if request.GET.page_size == "50" %}selected{% endif %}>50</option>
            <option value="100" {% if request.GET.page_size == "100" %}selected{% endif %}>100</option>
        </select>
    </div>
      <!-- Pagination Controls -->
<nav aria-label="Page navigation">
    <ul class="pagination d-flex justify-content-center">
        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page=1" aria-label="{% trans 'First' %}">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">{% trans "Previous" %}</a>
            </li>
        {% else %}
            <li class="page-item disabled">
                <span class="page-link">&laquo;</span>
            </li>
        {% endif %}

        <!-- Show a range of pages around the current page -->
        {% for page_num in page_obj.paginator.page_range %}
            {% if page_num >= page_obj.number|add:'-2' and page_num <= page_obj.number|add:'2' %}
                {% if page_num == page_obj.number %}
                    <li class="page-item active">
                        <span class="page-link">{{ page_num }}</span>
                    </li>
                {% else %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_num }}">{{ page_num }}</a>
                    </li>
                {% endif %}
            {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}">{% trans "Next" %}</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" aria-label="{% trans 'Last' %}">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        {% else %}
            <li class="page-item disabled">
                <span class="page-link">&raquo;</span>
            </li>
        {% endif %}
    </ul>
</nav>


    </div>
</div>





<script>
  function changeLimit() {
      var limit = document.getElementById('limit-select').value;
      var currentUrl = window.location.href.split('?')[0]; // Get base URL
      window.location.href = currentUrl + '?page_size=' + limit; // Redirect with page_size query param
  }
</script>

{% endblock content %}
