{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}
  kquires | {% trans "Search Results" %}
{% endblock title %}

{% block content %}
{% include "pages/layout/navbar.html" %}

<style>
    .search-results-list {
        list-style: none;
        padding: 5px;
        margin: 0px 50px 0px 50px;
    }

    .search-results-item {
        display: flex;
        justify-content: space-between;
        border-bottom: 1px dashed #ddd;
        padding: 15px 0;
    }

    .search-results-item a {
        font-size: 16px;
        color: #A94BEA;
        text-decoration: none;
    }

    .search-results-item a:hover {
        text-decoration: underline;
    }

    .search-results-item .description {
        font-size: 14px;
        color: #555;
        max-width: 80%;
        padding-right: 15px;
    }

    .search-results-item .view-article-btn {
        color: #A94BEA;
        text-decoration: none;
        font-weight: bold;
    }

    .search-results-item .view-article-btn:hover {
        text-decoration: underline;
    }

    .highlight {
        color: red;
        font-weight: bold;
    }
</style>

<div class="container my-5">
    {% include 'dashboard/partials/searchbar.html' %}
    <h1 class="text-center mb-4">{% trans "Search Results for" %} "{{ query }}"</h1>

    <div id="search-results-container">
        {% if results %}
            <ul class="search-results-list">
                {% for article in results %}
                    <li class="search-results-item">
                        <div>
                            <a href="/articles/{{ article.id }}/" class="article-title">{{ article.title|safe }}</a>
                            <p class="description">{{ article.short_description|truncatewords:20|safe }}</p>
                        </div>
                        <a href="/articles/{{ article.id }}/" class="view-article-btn">{% trans "View Article" %}</a>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-center text-muted">{% trans "No articles found for your search." %}</p>
        {% endif %}
    </div>
</div>

<script>
    
// Get the search query from the template
const query = "{{ query }}";

// Function to highlight matched text
function highlightMatch(text, query) {
    if (!text || !query) return text; // Handle empty descriptions or queries
    const regex = new RegExp(`(${query})`, "gi"); // Case-insensitive match
    return text.replace(regex, '<span class="highlight">$1</span>');
}

// Apply highlighting to all articles
document.querySelectorAll('.article-title, .description').forEach(element => {
    const originalText = element.innerHTML;
    element.innerHTML = highlightMatch(originalText, query);
});
</script>

{% endblock %}
