{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% block title %}
      kquires | {% trans 'Dashboard'%}
    {% endblock title %}
{% block content %}
{% include "pages/layout/navbar.html" %}
<style>
    .card {
        border: none;
        border-radius: 10px;
        box-shadow: 0px 1px 1px 0px rgba(49,67,81, 0.02),0px 2px 2px 0.5px rgba(49,67,81, 0.04),0px 4px 4px 1px rgba(49,67,81, 0.06)
    }
    .card:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .card-title {
        font-weight: bold;
        margin-bottom: 5px;
    }
    .card-text {
        font-size: 14px;
        color: #6c757d;
    }
    .list-item {
        display: flex;
        align-items: center;
        font-size: 14px;
        margin-bottom: 10px;
        color: #6c757d;
    }
    .list-item i {
        margin-right: 8px;
        color: #6c757d;
    }
    .view-all {
        color: #007bff;
        font-weight: bold;
        text-decoration: none;
    }
    .view-all:hover {
        text-decoration: underline;
    }
    #search-input:focus,
    #search-input:hover {
        outline: none !important;
        box-shadow: none !important;
        border-color: #A94BEA !important;
    }


    .text-hover:hover{
        color: #A94BEA !important;
    }
    .tag {
        display: inline-block;
        background-color: rgba(0, 0, 0, 0.05); /* Light grey background */
        padding: 6px 12px;
        border-radius: 12px; /* Rounded corners */
        font-size: 14px;
        font-weight: 500;
        color: #000;
        transition: background-color 0.3s ease;
        text-align: center;
        white-space: nowrap; /* Prevents wrapping */
    }

    .tag:hover {
        background-color: rgba(0, 0, 0, 0.1); /* Slight hover effect */
    }

    .text-decoration-none {
        text-decoration: none !important;
    }
    input::placeholder, textarea::placeholder {
        color:rgb(152, 152, 152);
    }

    #search-results a.dropdown-item {
        display: block;
        white-space: normal; /* Ensures text wraps properly */
        overflow: hidden;
        text-overflow: ellipsis; /* Adds "..." for overly long text */
        max-width: 100%; /* Ensures items do not exceed parent width */
        padding: 8px; /* Improves spacing for readability */
    }

    #search-results a.dropdown-item strong {
        display: block; /* Ensures title takes full width */
        overflow: hidden;
        text-overflow: ellipsis; /* Adds "..." if text is too long */
        white-space: nowrap; /* Keeps title on one line */
    }

    #search-results a.dropdown-item small {
        display: block;
        overflow: hidden;
        text-overflow: ellipsis;
        max-height: 3.6em; /* Limits description height */
        line-height: 1.2em;
        white-space: normal; /* Allows multiple lines */
    }

    .col-md-12 h5 a {
    color: white;
    text-decoration: underline !important;
    /* font-weight: bold;  */
    }

    .col-md-12 h5 a:hover {
    color: rgb(236, 236, 236);
    text-decoration: none;
    }

    /* The notification will push content down */
    .notification-banner {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    margin-top: 0;
    z-index: 999; /* Ensure it stays above other elements */
}



    .welcome-message {
    background-color: lightblue;
    padding: 20px;
    margin-top: 10px;
    }

    .main-content {
    margin-top: 10px;
    padding: 20px;
    background-color: #f4f4f4;
    }


    .alert-box {

    z-index: 1000; /* Ensure it's on top of other elements */
    width: 50%; /* Adjust width as needed */
    padding: 10px;
    margin: 0 auto; /* Centers the notification horizontally */


    }









</style>


<div class="container-fluid" id="wrapper">


    <div class="container-fluid justify-content-center">
        {% if alert %}
        {% if user.is_manager %}

        {% else %}
        <div class="row alert-box justify-content-center text-center">
            <div class="col-md-12 rounded bg-danger text-white p-2 overflow-hidden">

                    <h5>{{ alert.message|urlize|linebreaksbr|safe }}</h5>

            </div>
        </div>
        {% endif %}
        {% endif %}
    </div>

    <h1 class="row justify-content-center text-center mb-5"><strong>{% trans "Welcome" %} {{ request.user.name }}!</strong></h1>

    <div class="container mt-2">

        <div class="row text-center justify-content-center">
            {% if request.user.is_admin or request.user.is_article_writer or request.user.is_approval_manager %}
            <div class="col-lg-2 col-md-3 col-4 mb-3">
                <a href="{% url 'articles:list' %}">
                <div class="card" style="background-color: #F1DCDC;">
                    <div class="card-body">
                        <div class="logo-container">
                            <img src="{% static 'images/article.svg' %}" alt="File" class="card-logo">
                        </div>
                        <i class="bi bi-file-text fs-1 "></i>
                        <h6 class="mt-3 " style="color: #AE1919;">{% trans "Articles" %}</h6>
                    </div>
                </div>
            </a>
            </div>
            <div class="col-lg-2 col-md-3 col-4 mb-3">
                <a href="{% url 'categories:list' %}">
                <div class="card" style="background-color: #E6EFCD;">
                    <div class="card-body">
                        <div class="logo-container">
                            <img src="{% static 'images/category.svg' %}" alt="File" class="card-logo">
                        </div>
                        <i class="bi bi-folder fs-1 text-success"></i>
                        <h6 class="mt-3"  style="color: #789A14;">{% trans "Categories" %}</h6>
                    </div>
                </div>
                </a>
            </div>
            {% endif %}
            {% if request.user.is_admin or request.user.is_manager %}
            <div class="col-lg-2 col-md-3 col-4 mb-3">
                <a href="{% url 'dashboard:statistics' %}">
                <div class="card" style="background-color: #E4EAF6;">
                    <div class="card-body">
                        <div class="logo-container">
                            <img src="{% static 'images/statistic.svg' %}" alt="File" class="card-logo">
                        </div>
                        <i class="bi bi-person fs-1 text-warning"></i>
                        <h6 class="mt-3"  style="color: #0A266B;">
                            {% trans "Statistics" %}</h6>
                    </div>
                </div>
            </a>
            </div>
            {% endif %}
            {% if request.user.is_admin %}
            <div class="col-lg-2 col-md-3 col-4 mb-3">
                <a href="{% url 'users:list' %}">
                <div class="card" style="background-color: #D9E8F1;">
                    <div class="card-body">
                        <div class="logo-container">
                            <img src="{% static 'images/userfilled.svg' %}" alt="File" class="card-logo">
                        </div>
                        <i class="bi bi-person fs-1 text-warning"></i>
                        <h6 class="mt-3"  style="color: #084971;">
                            {% trans "User Management" %}</h6>
                    </div>
                </div>
            </a>
            </div>
            {% endif %}
        </div>

        {% include 'dashboard/partials/searchbar.html' %}

        <!-- Knowledge Base -->
        <div class="container-fluid text-white" style="margin-bottom:50px">
            <h1 class="text-black text-center" style="font-size:28px; font-weight:700 !important">{% trans "Knowledge Base" %}</h1>
            <div class="row mt-5">
                {% for category in categories %}
                <div class="col-lg-3 col-md-6 justify-content-center text-center p-3">

                    <div class="card px-3 bg-white" style="height:280px">
                        <div class="card-body py-2">
                            <a href="{% url 'articles:table_overview' %}?category_id={{category.id}}">
                                <div class="overflow-hidden" style="height:80px">
                                    <img class="py-2 img-fluid" width="50" src="{% if category.logo %}{{ category.logo.url }}{% else %}{% static 'images/weblogo.svg' %}{% endif %}" >
                                </div>
                                <div class="overflow-hidden" style="height:110px">
                            <h5 class="card-title py-2 fw-bolder text-black text-hover">{{ category.name }}</h5>

                            <p class="mb-0 text-black text-hover">{% trans 'Sub Categories' %}</p>
                        </a>
                            {% for sub_category in category.sub_categories.all %}

                            <a href="{% url 'articles:table_overview' %}?category_id={{category.id}}&sub_category_id={{sub_category.id}}"><p class="mb-0 text-black text-hover">{{sub_category.name}}</p></a>
                            {% endfor %}
                            {% if category.sub_categories.count > 2 %}
                            <a href="{% url 'articles:table_overview' %}?category_id={{category.id}}"><p class="text-decoration-underline text-black text-hover">{% trans 'View More' %}</p></a>
                            {% endif %}
                    </div>
                        {% with articles_count=category.get_approved_articles_count %}
                        <a href="{% url 'articles:table_overview' %}?category_id={{ category.id }}">
                            <p class="mt-5" style="color: #A94BEA">
                                {% blocktrans with count=articles_count %}
                                    {{ count }} Articles
                                {% endblocktrans %}
                            </p>
                        </a>
                        {% endwith %}
                        </div>
                    </div>

                </div>
                {% endfor %}
            </div>
        </div>


        <!-- Most Recent Articles -->
        <div class="row" style="margin-bottom:50px">
            <!-- Most Recent Articles Section -->
            <div class="col-md-6">
                <h1 class="mb-3 text-center text-black" style="font-size:28px; font-weight:700 !important">
                    {% trans "Most Recent Articles" %}
                </h1>
                <div class="bg-white border rounded px-3">
                    {% for article in most_recent_articles %}
                        <div class="row align-items-center py-3">
                            <!-- Left Column: Image -->
                            <div class="col-md-2 col-sm-4 d-flex justify-content-center">
                                <a href="{% url 'articles:index' article.id %}" class="text-black text-decoration-none">
                                    <img width="20" src="{% static 'images/rightarrow.svg' %}" alt="" class="ms-2">
                                </a>
                            </div>

                            <!-- Middle Column: Title & Description -->
                            <div class="col-md-6 col-sm-8 d-flex flex-column justify-content-center">
                                <a href="{% url 'articles:index' article.id %}" class="text-black text-decoration-none">
                                    <h5 class="mb-1">{{ article.title }}</h5>
                                </a>
                                <p class="text-muted mb-0">{{ article.short_description }}</p>
                            </div>

                            <!-- Right Column: Category Tags -->
                            <div class="col-md-4 col-sm-12 d-flex flex-wrap justify-content-md-end justify-content-start gap-2">
                                {% if article.category.parent_category %}
                                    <span class="tag">
                                        <a href="{% url 'articles:table_overview' %}?category_id={{ article.category.parent_category.id }}" class="text-decoration-none text-black">
                                            {{ article.category.parent_category.name }}
                                        </a>
                                    </span>
                                {% endif %}

                                <span class="tag">
                                    <a href="{% url 'articles:table_overview' %}?category_id={{ article.category.id }}" class="text-decoration-none text-black">
                                        {{ article.category.name }}
                                    </a>
                                </span>
                            </div>
                        </div>
                        <hr class="my-0">
                    {% endfor %}
                </div>
                <a href="{% url 'articles:table_overview' %}"
                   class="btn btn-sm text-white justify-content-center mx-auto d-flex text-center my-3"
                   type="button"
                   style="background-color: #A94BEA; height: 40px; width: 90px; font-size: 15px; border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
                    {% trans "View All" %}
                </a>
            </div>

            <!-- Most Visited Articles Section -->
            <div class="col-md-6">
                <h1 class="mb-3 text-center text-black" style="font-size:28px; font-weight:700 !important">
                    {% trans "Most Visited Articles" %}
                </h1>
                <div class="bg-white border rounded px-3">
                    {% for article in most_visited_articles %}
                        <div class="row align-items-center py-3">
                            <!-- Left Column: Image -->
                            <div class="col-md-2 col-sm-4 d-flex justify-content-center">
                                <a href="{% url 'articles:index' article.id %}" class="text-black text-decoration-none">
                                    <img width="20" src="{% static 'images/rightarrow.svg' %}" alt="" class="ms-2">
                                </a>
                            </div>

                            <!-- Middle Column: Title & Description -->
                            <div class="col-md-6 col-sm-8 d-flex flex-column justify-content-center">
                                <a href="{% url 'articles:index' article.id %}" class="text-black text-decoration-none">
                                    <h5 class="mb-1">{{ article.title }}</h5>
                                </a>
                                <p class="text-muted mb-0">{{ article.short_description }}</p>
                            </div>

                            <!-- Right Column: Category Tags -->
                            <div class="col-md-4 col-sm-12 d-flex flex-wrap justify-content-md-end justify-content-start gap-2">
                                {% if article.category.parent_category %}
                                    <span class="tag">
                                        <a href="{% url 'articles:table_overview' %}?category_id={{ article.category.parent_category.id }}" class="text-decoration-none text-black">
                                            {{ article.category.parent_category.name }}
                                        </a>
                                    </span>
                                {% endif %}

                                <span class="tag">
                                    <a href="{% url 'articles:table_overview' %}?category_id={{ article.category.id }}" class="text-decoration-none text-black">
                                        {{ article.category.name }}
                                    </a>
                                </span>
                            </div>
                        </div>
                        <hr class="my-0">
                    {% endfor %}
                </div>
                <a href="{% url 'articles:table_overview' %}"
                   class="btn btn-sm text-white justify-content-center mx-auto d-flex text-center my-3"
                   type="button"
                   style="background-color: #A94BEA; height: 40px; width: 90px; font-size: 15px; border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
                    {% trans "View All" %}
                </a>
            </div>
        </div>


    </div>
    {% if request.user.is_admin and inactive_users %}
    <div class="modal fade" id="inactiveUsersModal" tabindex="-1" role="dialog" aria-labelledby="inactiveUsersModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header row m-0" style="background: #a94bea; color: white">
                    <h5 class="modal-title col-md-8" id="inactiveUsersModalLabel">{% trans "Inactive Users" %}</h5>
                    <button type="button" class="btn-close btn-white col-md-4 ms-0" data-bs-dismiss="modal" aria-label="{% trans 'Close' %}"></button>
                </div>
                <div class="modal-body">
                    <p>{% trans "The following users are inactive. Please activate them" %}</p>
                    <ul>
                        {% for user in inactive_users %}
                            <li>{{ user.name }} - {{ user.email }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var inactiveUsersModal = document.getElementById('inactiveUsersModal');
        if (inactiveUsersModal) {
            // Show the modal by adding the 'show' class
            inactiveUsersModal.classList.add('show');
            inactiveUsersModal.style.display = 'block'; // Ensure it's visible
            inactiveUsersModal.setAttribute('aria-hidden', 'false');
        }

        // Close button functionality
        var closeBtn = document.querySelector('.btn-close');
        if (closeBtn) {
            closeBtn.addEventListener('click', function() {
                if (inactiveUsersModal) {
                    // Hide the modal by removing the 'show' class
                    inactiveUsersModal.classList.remove('show');
                    inactiveUsersModal.style.display = 'none'; // Hide the modal
                    inactiveUsersModal.setAttribute('aria-hidden', 'true');
                }
            });
        }
    });

    </script>
{% endif %}

</div>

{% endblock content %}
